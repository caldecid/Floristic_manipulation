list_fam_ipni[[i]]$native_to_botanical_countries = NA
list_fam_ipni[[i]]$introduced_to_country = NA
list_fam_ipni[[i]]$introduced_to_botanical_countries = NA
list_fam_ipni[[i]] = list_fam_ipni[[i]] %>% rename(taxon_name = name,
kew_id = id,
citation_type = citationType) %>%
select(family, genus, species, taxon_name, authors,
scientific_name, status, accepted_name,
reference, hybrid, distribution,
native_to_botanical_countries, introduce_to_country,
introduce_to_botanical_countries,
kew_id, url, source, publicationYear, citation_type)%>%
mutate(citation_type = if_else(citation_type == "tax. nov.",
"taxon_novo", citation_type))
}
load("C:/Users/OD32382/Desktop/Post doc/Domingos/Floristic_manipulation/Data/Metadata/Angiosperms/ipni_abs/ipni_fam_abs_2.RData")
for(i in seq_along(list_fam_ipni)) {
list_fam_ipni[[i]]$status = "Accepted"
list_fam_ipni[[i]]$scientific_name = paste(list_fam_ipni[[i]]$genus,
list_fam_ipni[[i]]$species,
list_fam_ipni[[i]]$authors)
list_fam_ipni[[i]]$accepted_name = list_fam_ipni[[i]]$scientific_name
list_fam_ipni[[i]]$source = "IPNI"
list_fam_ipni[[i]]$url = paste0("www.ipni.org", list_fam_ipni[[i]]$url)
list_fam_ipni[[i]]$native_to_botanical_countries = NA
list_fam_ipni[[i]]$introduced_to_country = NA
list_fam_ipni[[i]]$introduced_to_botanical_countries = NA
list_fam_ipni[[i]] = list_fam_ipni[[i]] %>% rename(taxon_name = name,
kew_id = id,
citation_type = citationType) %>%
select(family, genus, species, taxon_name, authors,
scientific_name, status, accepted_name,
reference, hybrid, distribution,
native_to_botanical_countries, introduced_to_country,
introduced_to_botanical_countries,
kew_id, url, source, publicationYear, citation_type)%>%
mutate(citation_type = if_else(citation_type == "tax. nov.",
"taxon_novo", citation_type))
}
View(list_fam_ipni)
x = list_expowo[[1]]
y = list_fam_ipni[[1]]
#binding dataframes
g = bind_rows(x, y)
g = g[!duplicated(g$taxon_name), ]
View(g)
sum(duplicated(g$taxon_name))
names_ipni = names(list_fam_ipni)
names_expowo = names(list_expowo)
match(names_expowo, names_ipni)
match(names_ipni, names_expowo)
h = match(names_ipni, names_expowo)
print(i)
for(i in h){
print(i)
}
h = match(names_expowo, names_ipni)
for(i in h){
print(i)
}
!which(names_expowo %in% names_ipni)
which(names_expowo %in% names_ipni)
h
names_expowo[1:5]
names_ipni[1:5]
h = match(names_ipni, names_expowo)
h
##looking for common family names in both dataframes
expo_com = which(names_expowo %in% names_ipni)
ipni_com = which(names_ipni %in% names_expowo)
ipni_com
length(expo_com)
length(ipni_com)
##subseting lists
list_expo_com = list_expowo[expo_com]
list_ipni_com = list_fam_ipni[ipni_com]
match(names(list_expo_com, list_ipni_com))
match(names(list_expo_com),names(list_ipni_com))
sum(match(names(list_expo_com),names(list_ipni_com)))
length(match(names(list_expo_com),names(list_ipni_com)))
View(list_ipni_com)
names(list_ipni_com) %in% names(list_expo_com)
which(names(list_ipni_com) %in% names(list_expo_com))
##empty list
list_combined = vector("list", length = length(list_ipni_com))
##empty list
list_combined = vector("list", length = length(list_ipni_com))
for(i in seq_along(list_expo_com)){
list_combined[[i]] = bind_rows(list_expo_com[[i]], list_ipni_com[[i]])
list_combined[[i]] = list_combined[[i]][!duplicated(list_combined[[i]]$taxon_name), ]
}
View(list_combined)
View(list_combined[[36]])
View(list_expo_com)
names(list_combined) = names(list_expo_com)
View(list_combined)
View(list_combined[["Gentianaceae"]])
##families only present in expowo
expo_only = !which(names_expowo %in% names_ipni)
##families only present in expowo
expo_only = list_expowo[-which(names_expowo %in% names_ipni)]
View(expo_only)
202-117
names_ipni == "Bixaceae"
##families only present in expowo
list_expo_only = list_expowo[-expo_com]
##families only present in IPNI
list_ipni_only = list_fam_ipni[-ipni_com]
View(list_ipni_only)
list_ipni_only[["Rosaceae"]]
###combining list
list_missing_data = c(list_combined, list_expo_only, list_ipni_only)
View(list_missing_data)
getwd()
save(list_missing_data, file = "C:/Users/OD32382/Desktop/Post doc/Domingos/Floristic_manipulation/Data/Processed/Angiosperms/missing_powo_ipni/list_missing.RData" )
df_missing <- do.call("rbind", list_missing_data)
df_missing <- do.call(rbind.data.frame, list_missing_data)
df_missing <- do.call(rbind, list_missing_data)
View(list_missing_data)
str(list_missing_data[["Acanthaceae"]])
View(list_missing_data[["Quiinaceae"]])
str(list_missing_data[["Quiinaceae"]])
df_missing <- do.call(rbind, list_missing_data)
df_missing <- do.call(bind_rows, list_missing_data)
View(df_missing)
library(writexl)
write_xlsx(df_missing, path = "C:/Users/OD32382/Desktop/Post doc/Domingos/Floristic_manipulation/Data/Processed/Angiosperms/missing_powo_ipni/df_missing.xlsx" )
write_csv(df_missing, file = "C:/Users/OD32382/Desktop/Post doc/Domingos/Floristic_manipulation/Data/Processed/Angiosperms/missing_powo_ipni/df_missing.csv")
for(i in seq_along(list_missing_data)){
tryCatch({
##reading excel files
write_xlsx(list_missing_data[[i]],
path = paste0(getwd(),
"/Data/Processed/Angiosperms/missing_powo_ipni/",
names(list_missing_data[[i]]), ".xlsx"))
}, error = function(e){
##enumerating the csv files
print(names(list_missing_data[[i]]))
})
}
names(list_missing_data[[2]])
##names missing
names_missing = names(list_missing_data)
names_missing
for(i in seq_along(list_missing_data)){
tryCatch({
##reading excel files
write_xlsx(list_missing_data[[i]],
path = paste0(getwd(),
"/Data/Processed/Angiosperms/missing_powo_ipni/",
names_missing[i], ".xlsx"))
}, error = function(e){
##enumerating the csv files
print(names_missing[i])
})
}
##some did not were converted to xlsx
csv_names = c("Apocynaceae", "Bignoniaceae", "Boraginaceae",
"Iridaceae","Rubiaceae")
##some did not were converted to xlsx
csv_names = c("Apocynaceae", "Bignoniaceae", "Boraginaceae",
"Iridaceae","Rubiaceae")
fd
csv_names
list_missing_data[[csv_names[i]]]
list_missing_data[[csv_names[1]]]
for(i in seq_along(csv_names)) {
write_csv(list_missing_data[[csv_names[i]]],
path = paste0(getwd(),
"/Data/Processed/Angiosperms/missing_powo_ipni/csv/",
csv_names[i], ".xlsx"))
}
for(i in seq_along(csv_names)) {
write_csv(list_missing_data[[csv_names[i]]],
file = paste0(getwd(),
"/Data/Processed/Angiosperms/missing_powo_ipni/csv/",
csv_names[i], ".csv"))
}
ex_files <- list.files(path = "Data/Processed/Angiosperms/missing_powo_ipni")
ex_files
ex_files <- ex_files[c(-111,61,67)]
ex_files <- ex_files[-c(111,61,67)]
length(ex_files)
library(tidyverse)
library(readxl)
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni",
ex_files[1]))
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[1]))
View(x)
levels(x$status)
x$status <- as.factor(x$status)
x
levels(x$status)
x.1 <- x %>% mutate(status = as.factor(status),
status = if_else(status == 'Accepted', 'Unknown', status),
status = as.factor(status))
View(x.1)
levles(x.1$status)
levels(x.1$status)
library(writexl)
x <- x %>% mutate(status = as.factor(status),
status = if_else(status == 'Accepted', 'Unknown', status),
status = as.factor(status))
ex_files[1]
ex_files[1])
write_xlsx(x, path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[1]))
for(i in seq_along(ex_files)){
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
x <- x %>% mutate(status = as.factor(status),
status = if_else(status == 'Accepted', 'Unknown', status),
status = as.factor(status))
write_xlsx(x, path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
}
seq_along(ex_files)
for(i in seq_along(ex_files)){
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
x <- x %>% mutate(status = as.factor(status),
status = if_else(status == 'Accepted', 'Unknown', status),
status = as.factor(status))
write_xlsx(x, path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
print[i]
}
print[1]
print(i)
for(i in seq_along(ex_files)){
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
x <- x %>% mutate(status = as.factor(status),
status = if_else(status == 'Accepted', 'Unknown', status),
status = as.factor(status))
write_xlsx(x, path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
print(i)
}
ex_files[10]
for(i in seq_along(ex_files)){
tryCatch({
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
x <- x %>% mutate(status = as.factor(status),
status = if_else(status == 'Accepted', 'Unknown', status),
status = as.factor(status))
write_xlsx(x, path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
print(i)
}, error = function(e){
##enumerating the csv files
print(ex_files[i])
})
}
###now the csv files
csv_files <- list.files(path = "Data/Processed/Angiosperms/missing_powo_ipni/csv")
x <- read_csv(file = paste0("Data/Processed/Angiosperms/missing_powo_ipni/csv",
csv_files[1]))
x <- read_csv(file = paste0("Data/Processed/Angiosperms/missing_powo_ipni/csv/",
csv_files[1]))
View(x)
x <- x %>% mutate(status = as.factor(status),
status = if_else(status == 'Accepted', 'Unknown', status),
status = as.factor(status))
levels(x$status)
for(i in seq_along(csv_files)){
tryCatch({
x <- read_csv(file = paste0("Data/Processed/Angiosperms/missing_powo_ipni/csv/",
csv_files[i]))
x <- x %>% mutate(status = as.factor(status),
status = if_else(status == 'Accepted', 'Unknown', status),
status = as.factor(status))
write_csv(x, file = paste0("Data/Processed/Angiosperms/missing_powo_ipni/csv/",
csv_files[i]))
print(i)
}, error = function(e){
##enumerating the csv files
print(csv_files[i])
})
}
x <- read_csv(file = paste0("Data/Processed/Angiosperms/missing_powo_ipni/csv/",
csv_files[3]))
View(x)
library(tidyverse)
library(readxl)
library(writexl)
##calling original dataset
angio_df <- read_excel("Data/Raw/datasheet_angiosperms_07Nov2023.xlsx")
##calling excel files
ex_files <- list.files(path = "Data/Processed/Angiosperms/missing_powo_ipni")
##removing csv files
ex_files <- ex_files[-c(111,61,67)]
##calling csv files
csv_files <- list.files(path = "Data/Processed/Angiosperms/missing_powo_ipni/csv")
ex_files <- list.files(path = "Data/Processed/Angiosperms/missing_powo_ipni")
##excel names
ex_names = str_remove_all(ex_files, ".xlsx")
##csv names
csv_names = str_remove_all(csv_files, ".csv")
View(angio_df)
View(angiosperms_bra)
##filtering only families
angio_fam <- angio_df %>% filter(Rank == "FAMILIA")
View(angio_fam)
seq_along(expowo_files)
angio_fam[,"Família"== ex_names[i]]$ID
angio_fam$ID
angio_fam[,Família== ex_names[i]]$ID
angio_fam[,"Família"]
angio_fam[,"Família"] == ex_names[i]
which(angio_fam[,"Família"] == ex_names[i])
which(angio_fam[,"Família"] == ex_names[1])
angio_fam[which(angio_fam[,"Família"] == ex_names[1]), ID]
angio_fam[which(angio_fam[,"Família"] == ex_names[1]), "ID"]
print(angio_fam[which(angio_fam[,"Família"] == ex_names[1]), "ID"])
paste0(ex_names[i], "_",angio_fam[which(angio_fam[,"Família"] == ex_names[1]), "ID"])
##First excel files
for(i in seq_along(ex_files)){
##reading datasets
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
##modifying the requested columns
x <- x %>% filter(hybrid == FALSE) %>%
mutate(status = case_when(source == "POWO" ~ "Accepted",
source == "IPNI" ~ status))
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
ex_names[i], "_",
angio_fam[which(angio_fam[,"Família"] == ex_names[i]), "ID"]))
}
library(readxl)
Acanthaceae <- read_excel("Data/Processed/Angiosperms/missing_powo_ipni/Acanthaceae.xlsx")
View(Acanthaceae)
##modifying the requested columns
x <- Acanthaceae %>% filter(hybrid == FALSE) %>%
mutate(status = case_when(source == "POWO" ~ "Accepted"))
View(x)
##First excel files
for(i in seq_along(ex_files)){
##reading datasets
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
tryCatch({
##modifying the requested columns
x <- x %>% filter(hybrid == FALSE) %>%
mutate(status = case_when(source == "POWO" ~ "Accepted",
source == "IPNI" ~ status))
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
ex_names[i], "_",
angio_fam[which(angio_fam[,"Família"] == ex_names[i]), "ID"],
".csv"))
}, error = function(e){
x <- x %>% filter(hybrid == FALSE)
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
ex_names[i], "_",
angio_fam[which(angio_fam[,"Família"] == ex_names[i]), "ID"],
".csv"))
})
}
ex_files
##calling excel files
ex_files <- list.files(path = "Data/Processed/Angiosperms/missing_powo_ipni")
##removing csv files
ex_files <- ex_files[-c(111,61,67)]
ex_files
##excel names
ex_names = str_remove_all(ex_files, ".xlsx")
##calling csv files
csv_files <- list.files(path = "Data/Processed/Angiosperms/missing_powo_ipni/csv")
##csv names
csv_names = str_remove_all(csv_files, ".csv")
##First excel files
for(i in seq_along(ex_files)){
##reading datasets
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
tryCatch({
##modifying the requested columns
x <- x %>% filter(hybrid == FALSE) %>%
mutate(status = case_when(source == "POWO" ~ "Accepted",
source == "IPNI" ~ status))
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
ex_names[i], "_",
angio_fam[which(angio_fam[,"Família"] == ex_names[i]), "ID"],
".csv"))
}, error = function(e){
x <- x %>% filter(hybrid == FALSE) %>% mutate(status = "Accepted")
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
ex_names[i], "_",
angio_fam[which(angio_fam[,"Família"] == ex_names[i]), "ID"],
".csv"))
})
}
##First excel files
for(i in seq_along(ex_files)){
##reading datasets
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
tryCatch({
##modifying the requested columns
x <- x %>% filter(hybrid == FALSE) %>%
mutate(status = case_when(source == "POWO" ~ "Accepted",
source == "IPNI" ~ status))
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
ex_names[i], "_", "FB",
angio_fam[which(angio_fam[,"Família"] == ex_names[i]), "ID"],
".csv"))
}, error = function(e){
x <- x %>% filter(hybrid == FALSE) %>% mutate(status = "Accepted")
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
ex_names[i], "_","FB",
angio_fam[which(angio_fam[,"Família"] == ex_names[i]), "ID"],
".csv"))
})
}
##First excel files
for(i in seq_along(csv_files)){
##reading datasets
x <- read_csv(file = paste0("Data/Processed/Angiosperms/missing_powo_ipni/csv/",
csv_files[i]))
##modifying the requested columns
x <- x %>% filter(hybrid == FALSE) %>%
mutate(status = case_when(source == "POWO" ~ "Accepted",
source == "IPNI" ~ status))
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
csv_names[i], "_", "FB",
angio_fam[which(angio_fam[,"Família"] == csv_names[i]), "ID"],
".csv"))
}
csv_names
View(angio_fam)
list.files(path = "Data/Processed/Angiosperms/final_family")
file.size(list.files > 0          )
final_files <- list.files(path = "Data/Processed/Angiosperms/final_family")
file.size(final_files) == 0
file.size(final_files) > 0
final_files <- list.files(path = "Data/Processed/Angiosperms/final_family")
file.size(final_files) > 0
final_files <- CSV_Files = dir(path = "Data/Processed/Angiosperms/final_family")
CSV_Files = dir(path = "Data/Processed/Angiosperms/final_family")
file.size(CSV_Files) > 0
library(readr)
Cabombaceae_FB69 <- read_csv("Data/Processed/Angiosperms/final_family/Cabombaceae_FB69.csv")
View(Cabombaceae_FB69)
length(Cabombaceae_FB69)
nrow(Cabombaceae_FB69)
library(tidyverse)
library(readxl)
library(writexl)
##calling original dataset
angio_df <- read_excel("Data/Raw/datasheet_angiosperms_07Nov2023.xlsx")
##filtering only families
angio_fam <- angio_df %>% filter(Rank == "FAMILIA")
##calling excel files
ex_files <- list.files(path = "Data/Processed/Angiosperms/missing_powo_ipni")
##removing csv files
ex_files <- ex_files[-c(111,61,67)]
##excel names
ex_names = str_remove_all(ex_files, ".xlsx")
##calling csv files
csv_files <- list.files(path = "Data/Processed/Angiosperms/missing_powo_ipni/csv")
##csv names
csv_names = str_remove_all(csv_files, ".csv")
##First excel files
for(i in seq_along(ex_files)){
##reading datasets
x <- read_excel(path = paste0("Data/Processed/Angiosperms/missing_powo_ipni/",
ex_files[i]))
tryCatch({
##modifying the requested columns
x <- x %>% filter(hybrid == FALSE) %>%
mutate(status = case_when(source == "POWO" ~ "Accepted",
source == "IPNI" ~ status))
if(nrow(x) == 0){
print(paste0("No missing species for", " ", ex_names[i]))
} else {
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
ex_names[i], "_", "FB",
angio_fam[which(angio_fam[,"Família"] == ex_names[i]), "ID"],
".csv"))
}
}, error = function(e){
if(nrow(x) == 0){
print(paste0("No missing species for", " ", ex_names[i]))
} else {
x <- x %>% filter(hybrid == FALSE) %>% mutate(status = "Accepted")
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
ex_names[i], "_","FB",
angio_fam[which(angio_fam[,"Família"] == ex_names[i]), "ID"],
".csv"))
}
})
}
##First excel files
for(i in seq_along(csv_files)){
##reading datasets
x <- read_csv(file = paste0("Data/Processed/Angiosperms/missing_powo_ipni/csv/",
csv_files[i]))
##modifying the requested columns
x <- x %>% filter(hybrid == FALSE) %>%
mutate(status = case_when(source == "POWO" ~ "Accepted",
source == "IPNI" ~ status))
if(nrow(x) == 0){
print(paste0("No missing species for", " ", csv_names[i]))
} else {
write_csv(x, file = paste0("Data/Processed/Angiosperms/final_family/",
csv_names[i], "_", "FB",
angio_fam[which(angio_fam[,"Família"] == csv_names[i]), "ID"],
".csv"))
}
}
