return(list_genus[[j]])
}, error = function(e){
message("Absent genus in POWO")
print(e)
})
}
list_expowo[[i]] = do.call("rbind.fill", list_genus)
}
View(list_expowo)
which(powo_fam== "Picrodendraceae")
which(powo_fam== "Brassicaceae")
which(names(list_expowo)== "Brassicaceae")
which(names(list_expowo)== "Picrodendraceae")
list_expowo[["Chrysobalanaceae"]]
list_expowo[["Brassicaceae"]]
unique(list_expowo[[21]]$family)
list_expowo <- list_expowo[-which(sapply(list_expowo, is.null))]
View(list_expowo)
for(i in seq_along(list_expowo)){
names(list_expowo[[i]]) == unique(list_expowo[[i]]$family)
}
View(list_expowo)
list_expowo[["Brassicaceae"]]$family
library(writexl)
getwd()
for(i in seq_along(list_expowo)) {
write_xlsx(list_expowo[[i]],
path = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[i]]$family), ".xlsx"))
print(unique(list_expowo[[i]]$family))
}
for(i in seq_along(list_expowo)) {
write_csv(list_expowo[[i]],
file = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[i]]$family), ".xlsx"))
print(unique(list_expowo[[i]]$family))
}
save(list_expowo, file = "Data/list_expowo.RData")
View(list_expowo)
View(list_expowo)
library(writexl)
for(i in seq_along(list_expowo)) {
write_xlsx(list_expowo[[i]],
path = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[i]]$family), ".xlsx"))
print(unique(list_expowo[[i]]$family))
}
##xlsx has some limits
write_csv(list_expowo[[1]],
file = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[1]]$family), ".csv"))
library(tidyverse)
##xlsx has some limits
write_csv(list_expowo[[1]],
file = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[1]]$family), ".csv"))
for(i in 2:length(list_expowo)) {
write_xlsx(list_expowo[[i]],
path = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[i]]$family), ".xlsx"))
print(unique(list_expowo[[i]]$family))
}
for(i in seq_along(list_expowo)){
x[i] = unique(list_expowo[[i]]$family)
}
x = vector("vector", length = length(list_expowo))
x = vector(mode = "character", length = length(list_expowo))
for(i in seq_along(list_expowo)){
x[i] = unique(list_expowo[[i]]$family)
}
x
sapply(list_expowo, dim(x)[1]!= 0)
dim(list_expowo[[1]])
dim(list_expowo[[1]])[1]
dim(list_expowo[[1]])[1] != 0
list_expowo <- list_expowo[-which(sapply(list_expowo, fun(x) dim(x)[1] == 0))]
sapply(list_expowo, fun(x)dim(x[1]==0)
lapply(list_expowo, fun(x)dim(x[1]==0)
?sapply
f2 <-
list_expowo <- list_expowo[-which(sapply(list_expowo,
function(x) dim(x)[1] == 0))]
View(list_expowo)
for(i in seq_along(list_expowo)){
x[i] = unique(list_expowo[[i]]$family)
}
x
x = vector(mode = "character", length = length(list_expowo))
for(i in seq_along(list_expowo)){
x[i] = unique(list_expowo[[i]]$family)
}
which(x== "Hypericaceae")
names(list_expowo) <- x
View(list_expowo)
View(list_expowo[["Phyllanthaceae"]])
View(list_expowo[["Lacistemataceae"]])
for(i in 44:length(list_expowo)) {
write_xlsx(list_expowo[[i]],
path = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[i]]$family), ".xlsx"))
print(unique(list_expowo[[i]]$family))
}
##xlsx has some limits
write_csv(list_expowo[[44]],
file = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[44]]$family), ".csv"))
x[44]
for(i in 45:length(list_expowo)) {
write_xlsx(list_expowo[[i]],
path = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[i]]$family), ".xlsx"))
print(unique(list_expowo[[i]]$family))
}
View(list_expowo)
which(powo_fam == "Phyllanthaceae")
length(powo_fam)
powo_fam
list_expowo2 = list_expowo
list_expowo <- vector("list", length = length(powo_fam) - length(list_expowo2))
list_expowo
View(list_expowo)
which(powo_fam == "Phyllantaceae")
which(powo_fam == "Phyllanthaceae")
list_expowo <- vector("list", length = length(powo_fam) -99)
length(powo_man)
length(powo_fam)
names(list_expowo) = powo_fam[100:142]
powo_fam[100:142]
df_powo_families
library(expowo)
library(plyr)
View(list_expowo)
for(i in 100:length(powo_fam)){
##filtering family
fam_powo = df_powo_families %>% filter(family == powo_fam[i])
##extracting genus
powo_genus = unique(fam_powo$genus)
list_genus <- vector("list", length = length(powo_genus))
for(j in seq_along(powo_genus)){
##implementing expowo
tryCatch({
##calling the species within families and genus in POWO
expowo_df = powoSpecies(family = powo_fam[i],
genus = powo_genus[j],
hybrid = TRUE,
synonyms = TRUE,
country = "Brazil")
#arranging taxa names
expowo_df$taxon_name = str_replace(expowo_df$taxon_name, " ", "_")
#POWO species absent in Flora de Brasil
list_genus[[j]]=
expowo_df[-which(expowo_df$taxon_name %in% angiosperms_bra$taxon_name), ]
return(list_genus[[j]])
}, error = function(e){
message("Absent genus in POWO")
print(e)
})
}
list_expowo[[i]] = do.call("rbind.fill", list_genus)
}
library(tidyverse)
library(expowo)
library(plyr)
View(list_expowo2)
View(list_expowo)
for(i in 100:length(powo_fam)){
##filtering family
fam_powo = df_powo_families %>% filter(family == powo_fam[i])
##extracting genus
powo_genus = unique(fam_powo$genus)
list_genus <- vector("list", length = length(powo_genus))
for(j in seq_along(powo_genus)){
##implementing expowo
tryCatch({
##calling the species within families and genus in POWO
expowo_df = powoSpecies(family = powo_fam[i],
genus = powo_genus[j],
hybrid = TRUE,
synonyms = TRUE,
country = "Brazil")
#arranging taxa names
expowo_df$taxon_name = str_replace(expowo_df$taxon_name, " ", "_")
#POWO species absent in Flora de Brasil
list_genus[[j]]=
expowo_df[-which(expowo_df$taxon_name %in% angiosperms_bra$taxon_name), ]
return(list_genus[[j]])
}, error = function(e){
message("Absent genus in POWO")
print(e)
})
}
list_expowo[[i]] = do.call("rbind.fill", list_genus)
}
library(expowo)
for(i in 100:length(powo_fam)){
##filtering family
fam_powo = df_powo_families %>% filter(family == powo_fam[i])
##extracting genus
powo_genus = unique(fam_powo$genus)
list_genus <- vector("list", length = length(powo_genus))
for(j in seq_along(powo_genus)){
##implementing expowo
tryCatch({
##calling the species within families and genus in POWO
expowo_df = powoSpecies(family = powo_fam[i],
genus = powo_genus[j],
hybrid = TRUE,
synonyms = TRUE,
country = "Brazil")
#arranging taxa names
expowo_df$taxon_name = str_replace(expowo_df$taxon_name, " ", "_")
#POWO species absent in Flora de Brasil
list_genus[[j]]=
expowo_df[-which(expowo_df$taxon_name %in% angiosperms_bra$taxon_name), ]
return(list_genus[[j]])
}, error = function(e){
message("Absent genus in POWO")
print(e)
})
}
list_expowo[[i]] = do.call("rbind.fill", list_genus)
}
expowo_df = powoSpecies(family = "Achariaceae"
hybrid = TRUE,
expowo_df = powoSpecies(family = "Achariaceae",
hybrid = TRUE,
synonyms = TRUE,
country = "Bolivia")
library(tidyverse)
library(expowo)
library(plyr)
View(list_expowo)
for(i in 100:length(powo_fam)){
##filtering family
fam_powo = df_powo_families %>% filter(family == powo_fam[i])
##extracting genus
powo_genus = unique(fam_powo$genus)
list_genus <- vector("list", length = length(powo_genus))
for(j in seq_along(powo_genus)){
##implementing expowo
tryCatch({
##calling the species within families and genus in POWO
expowo_df = powoSpecies(family = powo_fam[i],
genus = powo_genus[j],
hybrid = TRUE,
synonyms = TRUE,
country = "Brazil")
#arranging taxa names
expowo_df$taxon_name = str_replace(expowo_df$taxon_name, " ", "_")
#POWO species absent in Flora de Brasil
list_genus[[j]]=
expowo_df[-which(expowo_df$taxon_name %in% angiosperms_bra$taxon_name), ]
return(list_genus[[j]])
}, error = function(e){
message("Absent genus in POWO")
print(e)
})
}
list_expowo[[i]] = do.call("rbind.fill", list_genus)
}
View(list_expowo)
list_expowo[[100]]
library(tidyverse)
library(expowo)
library(plyr)
list_expowo <- vector("list", length = length(powo_fam)-99)
names(list_expowo) = powo_fam[100:142]
seq_along(list_expowo)
##second round
powo_fam = powo_fam[100:142]
powo_fam
list_expowo <- vector("list", length = length(powo_fam))
names(list_expowo) = powo_fam
View(list_expowo)
seq_along(powo_fam)
powo_fam[1]
for(i in seq_along(powo_fam)){
##filtering family
fam_powo = df_powo_families %>% filter(family == powo_fam[i])
##extracting genus
powo_genus = unique(fam_powo$genus)
list_genus <- vector("list", length = length(powo_genus))
for(j in seq_along(powo_genus)){
##implementing expowo
tryCatch({
##calling the species within families and genus in POWO
expowo_df = powoSpecies(family = powo_fam[i],
genus = powo_genus[j],
hybrid = TRUE,
synonyms = TRUE,
country = "Brazil")
#arranging taxa names
expowo_df$taxon_name = str_replace(expowo_df$taxon_name, " ", "_")
#POWO species absent in Flora de Brasil
list_genus[[j]]=
expowo_df[-which(expowo_df$taxon_name %in% angiosperms_bra$taxon_name), ]
return(list_genus[[j]])
}, error = function(e){
message("Absent genus in POWO")
print(e)
})
}
list_expowo[[i]] = do.call("rbind.fill", list_genus)
}
View(list_expowo)
powo_fam[43]
powo_fam
list_expowo[["Picrodendraceae"]]
View(list_expowo[["Zygophyllaceae"]])
save(list_expowo, file = "list_expowo_last.RData")
View(list_expowo[["Picrodendraceae"]])
View(list_expowo[["Verbenaceae"]])
View(list_expowo[["Rubiaceae"]])
View(list_expowo[["Vochysiaceae"]])
list_expowo <- list_expowo[-which(sapply(list_expowo, is.null))]
list_expowo <- list_expowo[-which(sapply(list_expowo,
function(x) dim(x)[1] == 0))]
View(list_expowo)
list_expowo[[40]]
for(i in seq_along(list_expowo)) {
write_xlsx(list_expowo[[i]],
path = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[i]]$family), ".xlsx"))
print(unique(list_expowo[[i]]$family))
}
library(writexl)
for(i in seq_along(list_expowo)) {
write_xlsx(list_expowo[[i]],
path = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[i]]$family), ".xlsx"))
print(unique(list_expowo[[i]]$family))
}
x = vector(mode = "character", length = length(list_expowo))
for(i in seq_along(list_expowo)){
x[i] = unique(list_expowo[[i]]$family)
}
which(x == "Rosaceae")
##xlsx has some limits
write_csv(list_expowo[[20]],
file = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[20]]$family), ".csv"))
x[20]
for(i in 21:length(list_expowo)) {
write_xlsx(list_expowo[[i]],
path = paste0("Data/Metadata/Angiosperms/expowo/expowo_syn/",
unique(list_expowo[[i]]$family), ".xlsx"))
print(unique(list_expowo[[i]]$family))
}
powo_fam
library(kewr)
library(tidyverse)
library(readr)
library(readxl)
library(plyr)
library(writexl)
angiosperms_bra <- read_excel("Data/Raw/datasheet_angiosperms_07Nov2023.xlsx") %>%
fill(Família, Gênero) %>%
drop_na(Espécie) %>%
unite("taxon_name", Gênero:Espécie, sep = "_", remove = FALSE)
View(angiosperms_bra)
##family names
fam_names <- unique(angiosperms_bra$Família)
######creating list for keeping the missing species within the families
list_fam_ang <- vector("list", length = length(fam_names))
##naming
names(list_fam_ang) <- fam_names
##loop for finding missing species in the Flora de Brasil
for(i in seq_along(fam_names)){
###tryCatch for handling the missing families in IPNI
tryCatch({
##calling the species within families in IPNI
ipni_df = tidy(search_ipni(list(family = fam_names[i],
distribution = "Brazil"),
limit = 1000))
##filtering for only considering species
ipni_df = ipni_df %>% filter(rank == "spec.")
return(ipni_df)
}, error = function(e){
message("Absent family in IPNI")
print(e)
})
#arranging taxa names
ipni_df$name = str_replace(ipni_df$name, " ", "_")
##IPNI species absent in Flora de Brasil
ipni_abs = ipni_df[-which(ipni_df$name %in% angiosperms_bra$taxon_name), ]
##if else statement for not saving empty dfs
if(dim(ipni_abs)[1] == 0){
print("No absent species in Flora de Brasil")
} else{
##inserting a df inside each list with the missing species in the Flora Brazil
list_fam_ang[[i]] = ipni_abs
}
}
View(list_fam_ang)
list_fam_ang[["Acanthaceae"]]
View(list_fam_ang[["Acanthaceae"]])
###removing null elements
list_fam_ipni = list_fam_ang[-which(sapply(list_fam_ang, is.null))]
##saving list
save(list_fam_ipni, file = "Data/Metadata/Angiosperms/ipni_2/ipni_fam_abs_2.RData")
##saving list
save(list_fam_ipni, file = "Data/Metadata/Angiosperms/ipni_abs/ipni_fam_abs_2.RData")
##for loop for saving as xlsx each family
for(i in seq_along(list_fam_ipni)){
df = list_fam_ipni[[i]] %>% select(any_of(c("family", "genus", "species",
"authors", "citationType",
"rank", "hybrid", "reference",
"publication", "publicationYear",
"referenceCollation",
"publicationId", "suppressed",
"typeLocations", "collectorTeam",
"collectionNumber", "collectionDate1",
"distribution", "locality", "id",
"fqld", "inPowo", "wfold", "bhlLink",
"publicationYearNote", "remarks",
"referenceRemarks")))
write_xlsx(df, path = paste0("Data/Metadata/Angiosperms/ipni_abs/",
unique(list_fam_ipni[[i]]$family),
".xlsx"))
}
list_fam_ipni[[2]]
View(list_fam_ipni)
View(list_fam_ipni[["Acanthaceae"]])
x = list_fam_ipni[[2]] %>% mutate(url = paste0("www.ipni.org/n/", list_fam_ipni[[2]]$id))
View(x)
colnames(x)
View(list_fam_ipni[["Brunelliaceae"]])
View(list_fam_ipni[["Arecaceae"]])
##for loop for saving as xlsx each family
for(i in seq_along(list_fam_ipni)){
df = list_fam_ipni[[i]] %>% select(any_of(c("family", "genus", "species",
"authors", "citationType",
"rank", "hybrid", "reference",
"publication", "publicationYear",
"referenceCollation",
"publicationId", "suppressed",
"typeLocations", "collectorTeam",
"collectionNumber", "collectionDate1",
"distribution", "locality", "id",
"fqld", "inPowo", "wfold", "bhlLink",
"publicationYearNote", "remarks",
"referenceRemarks"))) %>%
mutate(url = paste0("www.ipni.org/n/", list_fam_ipni[[i]]$id))
df$citationType <- "tax_nov"
write_xlsx(df, path = paste0("Data/Metadata/Angiosperms/ipni_abs/",
unique(list_fam_ipni[[i]]$family),
".xlsx"))
}
##for loop for saving as xlsx each family
for(i in seq_along(list_fam_ipni)){
df = list_fam_ipni[[i]] %>% select(any_of(c("family", "genus", "species",
"authors", "citationType",
"rank", "hybrid", "reference",
"publication", "publicationYear",
"referenceCollation",
"publicationId", "suppressed",
"typeLocations", "collectorTeam",
"collectionNumber", "collectionDate1",
"distribution", "locality", "id",
"fqld", "inPowo", "wfold", "bhlLink",
"publicationYearNote", "remarks",
"referenceRemarks"))) %>%
mutate(url = paste0("www.ipni.org/n/", list_fam_ipni[[i]]$id))
df$citationType <- "tax_nov"
df$source <- "ipni"
write_xlsx(df, path = paste0("Data/Metadata/Angiosperms/ipni_abs/",
unique(list_fam_ipni[[i]]$family),
".xlsx"))
}
##collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_ipni) %>%
select(any_of(c("family", "genus", "species",
"authors", "citationType",
"rank", "hybrid", "reference",
"publication", "publicationYear",
"referenceCollation",
"publicationId", "suppressed",
"typeLocations", "collectorTeam",
"collectionNumber", "collectionDate1",
"distribution", "locality", "id",
"fqld", "inPowo", "wfold", "bhlLink",
"publicationYearNote", "remarks",
"referenceRemarks")))%>%
mutate(url = paste0("www.ipni.org/n/", list_fam_ipni[[i]]$id))
##collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_ipni) %>%
select(any_of(c("family", "genus", "species",
"authors", "citationType",
"rank", "hybrid", "reference",
"publication", "publicationYear",
"referenceCollation",
"publicationId", "suppressed",
"typeLocations", "collectorTeam",
"collectionNumber", "collectionDate1",
"distribution", "locality", "id",
"fqld", "inPowo", "wfold", "bhlLink",
"publicationYearNote", "remarks",
"referenceRemarks")))%>%
mutate(url = paste0("www.ipni.org/n/", id))
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "ipni"
rownames(df_ipni_families) <- NULL
df_ipni_families$name <- str_c(df_ipni_families$genus,
df_ipni_families$species, sep = "_")
##eliminating duplicated species
df_ipni_families <- df_ipni_families[-which(duplicated(df_ipni_families$name)),]
##writing
write_csv(df_ipni_families,
file = "Data/Metadata/Angiosperms/ipni_2/ipni_fam_abs.csv")
##writing
write_csv(df_ipni_families,
file = "Data/Metadata/Angiosperms/ipni_abs/ipni_fam_abs.csv")
