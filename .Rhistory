legend.text = element_text(family = "serif", size = (10)),
axis.title = element_text(family = "serif", size = (11),
face = "bold"),
axis.text = element_text(family = "serif", size = (11)))
p2
p2 <- mis_plus20 %>%
ggplot(aes(x = family, y = number, fill = taxon))+
geom_bar(stat = "identity", position = "dodge") +
scale_fill_manual(values = c("#d8b365", "#5ab4ac"),
name = "Taxa",
breaks = c("unique_genus", "unique_sp"),
labels = c("Genus", "Species"))+
coord_flip()+
xlab("Family")+
ylab("Missing number")+
theme_bw()+
theme(legend.position = "bottom",
legend.title = element_text(family = "serif", size = (11),
face = "bold"),
legend.text = element_text(family = "serif", size = (10)),
axis.title = element_text(family = "serif", size = (11),
face = "bold"),
axis.text = element_text(family = "serif", size = (11)))
p2
theme_bw()+
theme(legend.position = "bottom",
legend.title = element_text(family = "serif", size = (11),
face = "bold"),
legend.text = element_text(family = "serif", size = (10)),
axis.title = element_text(family = "serif", size = (11),
face = "bold"),
axis.text = element_text(family = "serif", size = (11)),
plot.title = element_text(family = "serif", size = (12),
face = "bold"))
p2 <- mis_plus20 %>%
ggplot(aes(x = family, y = number, fill = taxon))+
geom_bar(stat = "identity", position = "dodge") +
scale_fill_manual(values = c("#d8b365", "#5ab4ac"),
name = "Taxa",
breaks = c("unique_genus", "unique_sp"),
labels = c("Genus", "Species"))+
coord_flip()+
xlab("Family")+
ylab("Missing number")+
ggtitle("Famílias com mais de 20 gêneros faltando no Flora")+
theme_bw()+
theme(legend.position = "bottom",
legend.title = element_text(family = "serif", size = (11),
face = "bold"),
legend.text = element_text(family = "serif", size = (10)),
axis.title = element_text(family = "serif", size = (11),
face = "bold"),
axis.text = element_text(family = "serif", size = (11)),
plot.title = element_text(family = "serif", size = (12),
face = "bold"))
p2
p2 <- mis_plus20 %>%
ggplot(aes(x = family, y = number, fill = taxon))+
geom_bar(stat = "identity", position = "dodge") +
scale_fill_manual(values = c("#d8b365", "#5ab4ac"),
name = "Taxa",
breaks = c("unique_genus", "unique_sp"),
labels = c("Gênero", "Espécies"))+
coord_flip()+
xlab("Família")+
ylab("Número de taxa faltante")+
ggtitle("Famílias com mais de 20 gêneros com espécies faltando no Flora")+
theme_bw()+
theme(legend.position = "bottom",
legend.title = element_text(family = "serif", size = (11),
face = "bold"),
legend.text = element_text(family = "serif", size = (10)),
axis.title = element_text(family = "serif", size = (11),
face = "bold"),
axis.text = element_text(family = "serif", size = (11)),
plot.title = element_text(family = "serif", size = (12),
face = "bold"))
p2
png("text/Figures/missing_plus20.png",
width = 17, height = 18, units = "cm",
pointsize = 8, res = 300)
p2 <- mis_plus20 %>%
ggplot(aes(x = family, y = number, fill = taxon))+
geom_bar(stat = "identity", position = "dodge") +
scale_fill_manual(values = c("#d8b365", "#5ab4ac"),
name = "Taxa",
breaks = c("unique_genus", "unique_sp"),
labels = c("Gênero", "Espécies"))+
coord_flip()+
xlab("Família")+
ylab("Número de taxa faltante")+
ggtitle("Famílias com mais de 20 gêneros com espécies faltando no Flora")+
theme_bw()+
theme(legend.position = "bottom",
legend.title = element_text(family = "serif", size = (11),
face = "bold"),
legend.text = element_text(family = "serif", size = (10)),
axis.title = element_text(family = "serif", size = (11),
face = "bold"),
axis.text = element_text(family = "serif", size = (11)),
plot.title = element_text(family = "serif", size = (12),
face = "bold"))
p2
dev.off()
library(kewr)
devtools::install_github("barnabywalker/kewr")
library(kewr)
library(dplyr)
library(readr)
#######calling fabacea from ipni
Fabacea_ipni <- tidy(search_ipni(list(family = "Fabaceae",
distribution = "Brazil"),
limit = 1000))
View(Fabacea_ipni)
#######calling fabacea from ipni
Fabacea_ipni <- tidy(search_ipni(list(family = "Fabaceae",
distribution = "Brazil"),
limit = 10000))
fabaceae_flora <- angiosperms_bra %>%
filter(Família == "Fabaceae")
View(fabaceae_flora)
View(fabaceae_flora)
View(Fabacea_ipni)
#######calling fabacea from ipni
Fabacea_ipni <- tidy(search_ipni(list(family = "Fabaceae",
distribution = "Brazil"),
limit = 6000))
#######calling fabacea from ipni
Fabacea_ipni <- tidy(search_ipni(list(family = "Fabaceae",
distribution = "Brazil"),
limit = 2000))
#######calling fabacea from ipni
Fabacea_ipni <- tidy(search_ipni(list(family = "Fabaceae",
distribution = "Brazil"),
limit = 1000))
#######calling fabacea from ipni
Fabacea_ipni <- tidy(search_ipni(list(family = "Fabaceae",
distribution = "Brazil"),
limit = 1500))
?search_ipni
?search_powo
Fabaceae_powo <- tidy(search_powo(list(family = "Fabaceae",
distribution = "Brazil"),
limit = 2000))
View(Fabaceae_powo)
Fabaceae_powo <- tidy(search_powo(list(family = "Fabaceae",
distribution = "Brazil"),
limit = 3000))
View(Fabaceae_powo)
Leguminosae_powo <- tidy(search_powo(list(family = "Leguminosae",
distribution = "Brazil"),
limit = 3000))
View(Leguminosae_powo)
Fabaceae_powo <- tidy(search_powo(list(family = "Fabaceae",
distribution = "Brazil"),
limit = 5000))
View(Fabaceae_powo)
View(Fabacea_ipni)
?search_ipni
Fabaceae_powo$name[1]
View(Fabacea_ipni)
Fabaceae_powo <- Fabaceae_powo %>% filter(rank == "Species")
Fabacea_ipni_sp <- tidy(search_powo(list(species = Fabaceae_powo$name[1]))
Fabacea_ipni_sp <- tidy(search_powo(list(species = Fabaceae_powo$name[1])))
Fabacea_ipni_sp <- tidy(search_powo(list(species = Fabaceae_powo$name[2])))
Fabacea_ipni_sp <- tidy(search_powo(species = Fabaceae_powo$name[2]))
Fabacea_ipni_sp <- tidy(search_powo(list(species = Fabaceae_powo$name[56])))
View(Fabacea_ipni)
Fabacea_ipni_sp <- tidy(search_powo(list(species = "Abarema barnebyana")))
limit = 1000)
Fabacea_ipni_sp <- tidy(search_ipni(list(family ="Fabaceae",
published = 2008:2020,
distribution = "Brazil",
filters=c("species"),
limit = 1000)))
Fabacea_ipni_sp <- tidy(search_ipni(list(family ="Fabaceae",
published = 2008:2020,
distribution = "Brazil",
#filters=c("species"),
limit = 1000)))
Fabacea_ipni_sp <- tidy(search_ipni(list(family ="Fabaceae",
published = 2008,
distribution = "Brazil",
#filters=c("species"),
limit = 1000)))
Fabacea_ipni_sp <- tidy(search_ipni(list(family ="Fabaceae",
#published = 2008,
distribution = "Brazil",
#filters=c("species"),
limit = 1000)))
search_ipni(list(genus="Poa", published=1920),
filters=c("species"))
search_ipni(list(family ="Fabaceae", published=2008),
filters=c("species"))
x <- tidy(search_ipni(list(family ="Fabaceae", published=2008),
filters=c("species")))
View(x)
x <- tidy(search_ipni(list(family ="Fabaceae", published=2008),
ditribution = "Brazil",
filters=c("species")))
x <- tidy(search_ipni(list(family ="Fabaceae", published=2008),
distribution = "Brazil",
filters=c("species")))
x <- tidy(search_ipni(list(family ="Fabaceae", published=2008),
distribution = "Brazil",
filters=c("species")))
x <- tidy(search_ipni(list(family ="Fabaceae", published=2008,
distribution = "Brazil"),
filters=c("species")))
x <- tidy(search_ipni(list(family ="Fabaceae", published=2008:2020,
distribution = "Brazil"),
filters=c("species")))
x <- tidy(search_ipni(list(family ="Fabaceae", published = c(2008, 2009),
distribution = "Brazil"),
filters=c("species")))
x <- 2008:2020
fabacea_list <- vector("list", length(x))
for(i in seq_along(x)){
fabacea_list[[x]] <- tidy(search_ipni(list(family ="Fabaceae",
published = x[i],
distribution = "Brazil"),
filters=c("species")))
}
x <- 2008:2020
fabacea_list <- vector("list", length(x))
for(i in seq_along(x)){
fabacea_list[[x]] <- tidy(search_ipni(list(family = "Fabaceae",
published = x[i],
distribution = "Brazil"),
filters=c("species")))
}
View(fabacea_list)
x <- 2008:2020
fabacea_list <- vector("list", length(x))
for(i in seq_along(x)){
fabacea_list[[i]] <- tidy(search_ipni(list(family = "Fabaceae",
published = x[i],
distribution = "Brazil"),
filters=c("species")))
}
fabacea_list[[13]]
fabacea_2008_2020 <- do.call("rbind", fabacea_list)
install.packages("plyr")
library(plyr)
fabacea_2008_2020 <- do.call("rbind.fill", fabacea_list)
View(fabacea_2008_2020)
distribution = "Brazil"))
published = 2008,
fabacea_2008_2020 <- do.call("rbind.fill", fabacea_list) %>%
relocate(family, genus, species)
View(fabacea_2008_2020)
View(angiosperms_bra)
colnames(angiosperms_bra)
fabacea_2008_2020_brasil <- do.call("rbind.fill", fabacea_list) %>%
relocate(family, genus, species)
fabaceae_missing <- read_csv("Data/Metadata/Angiosperms/ipni/Leguminosidae.csv")
fabaceae_missing <- read_csv("Data/Metadata/Angiosperms/ipni/Leguminosae.csv")
fabaceae_missing <- readxl::read_excel("Data/Metadata/Angiosperms/ipni/Leguminosae.xlsx")
View(fabaceae_missing)
###Fabaceae missing in Flora
fabaceae_2008_2020_faltantes <- fabaceae_missing %>%
filter(publicationYear %in% 2008:2020)
View(fabaceae_2008_2020_faltantes)
library(writexl)
##writing fabacea 2008 to 2020 absent in Flora
write_xlsx(fabaceae_2008_2020_faltantes,
path = "Data/Processed/Angiosperms/fabaceae_2008_2020_faltantes.xlsx")
write_xlsx(fabacea_2008_2020_brasil,
path = "Data/Processed/Angiosperms/fabacea_2008_2020_brasil_ipni.xlsx")
write_xlsx(fabacea_2008_2020_brasil,
path = "Data/Processed/Angiosperms/fabaceae_2008_2020_brasil_ipni.xlsx")
library(kewr)
library(writexl)
library(plyr)
library(tidyverse)
library(plyr)
library(readxl)
Orchidaceae_missing <- read_excel("Data/Metadata/Angiosperms/ipni/Orchidaceae.xlsx")
View(Orchidaceae_missing)
###Orchidaceae missing in Flora
Orchidaceae_2008_2020_faltantes <- Orchidaceae_missing %>%
filter(publicationYear %in% 2008:2020)
View(Orchidaceae_2008_2020_faltantes)
##writing fabacea 2008 to 2020 absent in Flora
write_xlsx(Orchidaceae_2008_2020_faltantes,
path = "Data/Processed/Angiosperms/Orchidaceae_2008_2020_faltantes.xlsx")
##calling Fabacea  2008 to 2020, in Brazil according to IPNI
x <- 2008:2020
orchidaceae_list <- vector("list", length(x))
for(i in seq_along(x)){
orchidaceae_list[[i]] <- tidy(search_ipni(list(family = "Orchidaceae",
published = x[i],
distribution = "Brazil"),
filters=c("species")))
}
orchidaceae_2008_2020_brasil <- do.call("rbind.fill", orchidaceae_list) %>%
relocate(family, genus, species)
View(orchidaceae_2008_2020_brasil)
write_xlsx(orchidaceae_2008_2020_brasil,
path = "Data/Processed/Angiosperms/Orchidaceae_2008_2020_brasil_ipni.xlsx")
Asteraceae_missing <- read_excel("Data/Metadata/Angiosperms/ipni/Asteraceae.xlsx")
###Asteraceae missing in Flora
Asteraceae_2008_2020_faltantes <- Asteraceae_missing %>%
filter(publicationYear %in% 2008:2020)
View(Asteraceae_2008_2020_faltantes)
##writing fabacea 2008 to 2020 absent in Flora
write_xlsx(Asteraceae_2008_2020_faltantes,
path = "Data/Processed/Angiosperms/Asteraceae_2008_2020_faltantes.xlsx")
##calling Fabacea  2008 to 2020, in Brazil according to IPNI
x <- 2008:2020
Asteraceae_list <- vector("list", length(x))
for(i in seq_along(x)){
Asteraceae_list[[i]] <- tidy(search_ipni(list(family = "Asteraceae",
published = x[i],
distribution = "Brazil"),
filters=c("species")))
}
Asteraceae_2008_2020_brasil <- do.call("rbind.fill", Asteraceae_list) %>%
relocate(family, genus, species)
View(Asteraceae_2008_2020_brasil)
write_xlsx(Asteraceae_2008_2020_brasil,
path = "Data/Processed/Angiosperms/Asteraceae_2008_2020_brasil_ipni.xlsx")
Rubiaceae_missing <- read_excel("Data/Metadata/Angiosperms/ipni/Rubiaceae.xlsx")
###Rubiaceae missing in Flora
Rubiaceae_2008_2020_faltantes <- Rubiaceae_missing %>%
filter(publicationYear %in% 2008:2020)
View(Rubiaceae_2008_2020_faltantes)
##writing fabacea 2008 to 2020 absent in Flora
write_xlsx(Rubiaceae_2008_2020_faltantes,
path = "Data/Processed/Angiosperms/Rubiaceae_2008_2020_faltantes.xlsx")
##calling Rubiaceae  2008 to 2020, in Brazil according to IPNI
x <- 2008:2020
Rubiaceae_list <- vector("list", length(x))
for(i in seq_along(x)){
Rubiaceae_list[[i]] <- tidy(search_ipni(list(family = "Rubiaceae",
published = x[i],
distribution = "Brazil"),
filters=c("species")))
}
Rubiaceae_2008_2020_brasil <- do.call("rbind.fill", Rubiaceae_list) %>%
relocate(family, genus, species)
write_xlsx(Rubiaceae_2008_2020_brasil,
path = "Data/Processed/Angiosperms/Rubiaceae_2008_2020_brasil_ipni.xlsx")
View(Rubiaceae_2008_2020_brasil)
Melastomataceae_missing <- read_excel("Data/Metadata/Angiosperms/ipni/Melastomataceae.xlsx")
###Melastomataceae missing in Flora
Melastomataceae_2008_2020_faltantes <- Melastomataceae_missing %>%
filter(publicationYear %in% 2008:2020)
##writing fabacea 2008 to 2020 absent in Flora
write_xlsx(Melastomataceae_2008_2020_faltantes,
path = "Data/Processed/Angiosperms/Melastomataceae_2008_2020_faltantes.xlsx")
##calling Melastomataceae  2008 to 2020, in Brazil according to IPNI
x <- 2008:2020
Melastomataceae_list <- vector("list", length(x))
for(i in seq_along(x)){
Melastomataceae_list[[i]] <- tidy(search_ipni(list(family = "Melastomataceae",
published = x[i],
distribution = "Brazil"),
filters=c("species")))
}
Melastomataceae_2008_2020_brasil <- do.call("rbind.fill", Melastomataceae_list) %>%
relocate(family, genus, species)
write_xlsx(Melastomataceae_2008_2020_brasil,
path = "Data/Processed/Angiosperms/Melastomataceae_2008_2020_brasil_ipni.xlsx")
fabaceae_missing
View(fabaceae_2008_2020_faltantes)
##calling Fabacea  2008 to 2020, in Brazil according to IPNI
x <- 2008:2020
fabacea_list <- vector("list", length(x))
for(i in seq_along(x)){
fabacea_list[[i]] <- tidy(search_ipni(list(family = "Fabaceae",
published = x[i],
distribution = "Brazil"),
filters=c("species")))
}
fabacea_2008_2020_brasil <- do.call("rbind.fill", fabacea_list) %>%
relocate(family, genus, species)
View(fabacea_2008_2020_brasil)
View(fabacea_2008_2020_brasil)
View(orchidaceae_2008_2020_brasil[[7]][[1]])
unique(orchidaceae_2008_2020_brasil$citationType)
View(angiosperms_bra)
unique(angiosperms_bra$Status)
unique(angiosperms_bra$Registro)
unique(angiosperms_bra$Qualificador)
View(angiosperms_bra)
View(Asteraceae_2008_2020_brasil)
View(Fabaceae_powo)
library(kewr)
library(dplyr)
library(readr)
library(readxl)
library(plyr)
library(writexl)
######creating list for keeping the missing species within the families
list_fam_ang <- vector("list", length = length(fam_names))
##naming
names(list_fam_ang) <- fam_names
##loop for finding missing species in the Flora de Brasil
for(i in seq_along(fam_names)){
##subseting the angiosperm df
#angio_fam = angiosperms_bra %>% filter(Família == fam_names[i])
###tryCatch for handling the missing families in IPNI
tryCatch({
##calling the species within families in IPNI
ipni_df = tidy(search_ipni(list(family = fam_names[i],
distribution = "Brazil"),
limit = 1000))
##filtering for only considering species
ipni_df = ipni_df %>% filter(rank == "spec.")
return(ipni_df)
}, error = function(e){
message("Absent family in IPNI")
print(e)
})
#arranging taxa names
ipni_df$name = str_replace(ipni_df$name, " ", "_")
##IPNI species absent in Flora de Brasil
ipni_abs = ipni_df[-which(ipni_df$name %in% angiosperms_bra$taxon_name), ]
##if else statement for not saving empty dfs
if(dim(ipni_abs)[1] == 0){
print("No absent species in Flora de Brasil")
} else{
##inserting a df inside each list with the missing species in the Flora Brazil
list_fam_ang[[i]] = ipni_abs
}
}
library(tidyverse)
######creating list for keeping the missing species within the families
list_fam_ang <- vector("list", length = length(fam_names))
##naming
names(list_fam_ang) <- fam_names
##loop for finding missing species in the Flora de Brasil
for(i in seq_along(fam_names)){
##subseting the angiosperm df
#angio_fam = angiosperms_bra %>% filter(Família == fam_names[i])
###tryCatch for handling the missing families in IPNI
tryCatch({
##calling the species within families in IPNI
ipni_df = tidy(search_ipni(list(family = fam_names[i],
distribution = "Brazil"),
limit = 1000))
##filtering for only considering species
ipni_df = ipni_df %>% filter(rank == "spec.")
return(ipni_df)
}, error = function(e){
message("Absent family in IPNI")
print(e)
})
#arranging taxa names
ipni_df$name = str_replace(ipni_df$name, " ", "_")
##IPNI species absent in Flora de Brasil
ipni_abs = ipni_df[-which(ipni_df$name %in% angiosperms_bra$taxon_name), ]
##if else statement for not saving empty dfs
if(dim(ipni_abs)[1] == 0){
print("No absent species in Flora de Brasil")
} else{
##inserting a df inside each list with the missing species in the Flora Brazil
list_fam_ang[[i]] = ipni_abs
}
}
View(list_fam_ang)
###removing null elements
list_fam_ipni = list_fam_ang[-which(sapply(list_fam_ang, is.null))]
##saving list
save(list_fam_ipni, file = "Data/Metadata/Angiosperms/ipni/ipni_fam_abs_2.RData")
View(list_fam_ang)
###removing null elements
list_fam_ipni = list_fam_ang[-which(sapply(list_fam_ang, is.null))]
View(list_fam_ipni)
##saving list
save(list_fam_ipni, file = "Data/Metadata/Angiosperms/ipni_2/ipni_fam_abs_2.RData")
##for loop for saving as xlsx each family
for(i in seq_along(list_fam_ipni)){
df = list_fam_ipni[[i]] %>% select(any_of(c("family", "genus", "species",
"authors", "citationType",
"rank", "hybrid", "reference",
"publication", "publicationYear",
"referenceCollation",
"publicationId", "suppressed",
"typeLocations", "collectorTeam",
"collectionNumber", "collectionDate1",
"distribution", "locality", "id",
"fqld", "inPowo", "wfold", "bhlLink",
"publicationYearNote", "remarks",
"referenceRemarks")))
write_xlsx(df, path = paste0("Data/Metadata/Angiosperms/ipni_2/",
unique(list_fam_ipni[[i]]$family),
".xlsx"))
}
##collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_ipni) %>%
select(any_of(c("family", "genus", "species",
"authors", "citationType",
"rank", "hybrid", "reference",
"publication", "publicationYear",
"referenceCollation",
"publicationId", "suppressed",
"typeLocations", "collectorTeam",
"collectionNumber", "collectionDate1",
"distribution", "locality", "id",
"fqld", "inPowo", "wfold", "bhlLink",
"publicationYearNote", "remarks",
"referenceRemarks")))
rownames(df_ipni_families) <- NULL
df_ipni_families$name <- str_c(df_ipni_families$genus,
df_ipni_families$species, sep = "_")
##eliminating duplicated species
df_ipni_families <- df_ipni_families[-which(duplicated(df_ipni_families$name)),]
##writing
write_csv(df_ipni_families,
file = "Data/Metadata/Angiosperms/ipni_2/ipni_fam_abs.csv")
