##family names
fam_names <- unique(species_bra$Família)
fam_names
######creating list for keeping the missing species within each family according to IPNI
list_fam_IPNI <- vector("list", length = length(fam_names))
######creating list for keeping the missing species within each family according to POWO
list_fam_POWO <- vector("list", length = length(fam_names))
##naming
names(list_fam_IPNI) <- fam_names
names(list_fam_POWO) <- fam_names
##loop for finding missing species in the Flora de Brasil
for(i in seq_along(fam_names)){
tryCatch({
##calling the species within families in IPNI
ipni_df = tidy(search_ipni(list(family = fam_names[i],
distribution = "Brazil"),
limit = 1000,
filters = c("species")))
list_fam_IPNI[[i]] = ipni_df
}, error = function(e){
message("Absent family in IPNI")
print(e)
})
}
###removing 0 elements
list_fam_IPNI = list_fam_IPNI[lengths(list_fam_IPNI) > 0L]
View(list_fam_IPNI)
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
select(any_of(c("family", "genus", "species",
"authors", "citationType",
"rank", "hybrid", "reference",
"publication", "publicationYear",
"referenceCollation",
"publicationId", "suppressed",
"typeLocations", "collectorTeam",
"collectionNumber", "collectionDate1",
"distribution", "locality", "id",
"fqld", "inPowo", "wfold", "bhlLink",
"publicationYearNote", "remarks",
"referenceRemarks")))%>%
mutate(url = paste0("www.ipni.org/n/", id))
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
rownames(df_ipni_families) <- NULL
##generating species names for further merging
df_ipni_families$name <- str_c(df_ipni_families$genus,
df_ipni_families$species, sep = "_")
##loop for finding species
for(i in seq_along(fam_names)){
###tryCatch for handling the missing families in POWO
tryCatch({
##calling the species within families in POWO
powo_df = tidy(search_powo(list(family = fam_names[i],
distribution = "Brazil"),
limit = 1000,
filters = c("species", "accepted")))
#arranging taxa names
powo_df$name = str_replace(powo_df$name, " ", "_")
list_fam_POWO[[i]] = powo_df
}, error = function(e){
message("Absent family in POWO")
print(e)
})
}
View(list_fam_POWO)
###removing 0 elements
list_fam_POWO = list_fam_POWO[lengths(list_fam_POWO) > 0L]
##collapsing the list in a df
df_powo_families <- do.call("rbind", list_fam_POWO)
##collapsing the list in a df
df_powo_families <- do.call("rbind.fill", list_fam_POWO)
rownames(df_powo_families) <- NULL
##Source
df_powo_families$source <- "POWO"
##merging dataframes, not repeating species from both repositories
df_total <- rbind.fill(df_ipni_families,
df_powo_families[!df_powo_families$name %in% df_ipni_families$name,])
df_total
present_FB <- function(df){
##completing dataframe information (auxiliary function)
species_bra = complete_angio_df(df = df)
##family names
fam_names <- unique(species_bra$Família)
######creating list for keeping the missing species within each family according to IPNI
list_fam_IPNI <- vector("list", length = length(fam_names))
######creating list for keeping the missing species within each family according to POWO
list_fam_POWO <- vector("list", length = length(fam_names))
##naming
names(list_fam_IPNI) <- fam_names
names(list_fam_POWO) <- fam_names
###################IPNI######################################
##loop for finding missing species in the Flora de Brasil
for(i in seq_along(fam_names)){
tryCatch({
##calling the species within families in IPNI
ipni_df = tidy(search_ipni(list(family = fam_names[i],
distribution = "Brazil"),
limit = 1000,
filters = c("species")))
list_fam_IPNI[[i]] = ipni_df
}, error = function(e){
message("Absent family in IPNI")
print(e)
})
}
###removing 0 elements
list_fam_IPNI = list_fam_IPNI[lengths(list_fam_IPNI) > 0L]
#####collapsing the list in a df
df_ipni_families <- do.call("rbind.fill", list_fam_IPNI) %>%
select(any_of(c("family", "genus", "species",
"authors", "citationType",
"rank", "hybrid", "reference",
"publication", "publicationYear",
"referenceCollation",
"publicationId", "suppressed",
"typeLocations", "collectorTeam",
"collectionNumber", "collectionDate1",
"distribution", "locality", "id",
"fqld", "inPowo", "wfold", "bhlLink",
"publicationYearNote", "remarks",
"referenceRemarks")))%>%
mutate(url = paste0("www.ipni.org/n/", id))
##working with the columns
df_ipni_families$citationType <- "tax_nov"
df_ipni_families$source <- "IPNI"
rownames(df_ipni_families) <- NULL
##generating species names for further merging
df_ipni_families$name <- str_c(df_ipni_families$genus,
df_ipni_families$species, sep = "_")
#############POWO#############################
##loop for finding species
for(i in seq_along(fam_names)){
###tryCatch for handling the missing families in POWO
tryCatch({
##calling the species within families in POWO
powo_df = tidy(search_powo(list(family = fam_names[i],
distribution = "Brazil"),
limit = 1000,
filters = c("species", "accepted")))
#arranging taxa names
powo_df$name = str_replace(powo_df$name, " ", "_")
list_fam_POWO[[i]] = powo_df
}, error = function(e){
message("Absent family in POWO")
print(e)
})
}
###removing 0 elements
list_fam_POWO = list_fam_POWO[lengths(list_fam_POWO) > 0L]
##collapsing the list in a df
df_powo_families <- do.call("rbind.fill", list_fam_POWO)
rownames(df_powo_families) <- NULL
##Source
df_powo_families$source <- "POWO"
##merging dataframes, not repeating species from both repositories
df_total <- rbind.fill(df_ipni_families,
df_powo_families[!df_powo_families$name %in% df_ipni_families$name,])
return(df_total)
}
angio = read_excel("Data/Raw/datasheet_angiosperms_07Nov2023.xlsx")
##looking in powo and ipni
angio_rep = present_FB(angio)
x <- angio_rep %>% filter(publicationYear >= 2013) %>%
count('publicationYear') %>%
mutate(tot = cumsum(freq))
write_csv(x, file = "Data/Metadata/Angiosperms/angio_riqueza.csv")
#themes
mynamestheme <- theme(strip.text = element_text(family = "serif", size = (11)),
axis.title = element_text(family = "serif", size = (12),
face = "bold"),
axis.text = element_text(family = "serif", size = (9)),
legend.title = element_text(family = "serif", size = (11),
face = "bold"),
legend.text = element_text(family = "serif", size = (10)),
legend.position = "bottom",
legend.background = element_rect(fill="gray90",
size=.5, linetype="dotted"))
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 150, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 770, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Angiospermas")+
theme_bw()
x
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 300, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 1900, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Angiospermas")+
theme_bw()
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 400, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 1950, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Angiospermas")+
theme_bw()
##with the cumulative sum
png("text/Figures/angio_sp_acum.png", width = 17,
height = 12, units = "cm",
pointsize = 8, res = 300)
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 400, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 1950, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Angiospermas")+
theme_bw()
dev.off()
##with the frequency
png("text/Figures/angio_sp_freq.png", width = 17,
height = 12, units = "cm",
pointsize = 8, res = 300)
ggplot(x, aes(x = publicationYear, y = freq))+
geom_line()+
geom_point()+
geom_label(label = x$freq)+
#geom_label(label = "HV", x = 2013, y = 150, fill = "lightblue")+
#geom_label(label = "Flora Brasil", x = 2020, y = 765, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies descritas")+
ggtitle("Angiospermas")+
theme_bw()
dev.off()
ggplot(x, aes(x = publicationYear, y = freq))+
geom_line()+
geom_point()+
geom_label(label = x$freq)+
#geom_label(label = "HV", x = 2013, y = 150, fill = "lightblue")+
#geom_label(label = "Flora Brasil", x = 2020, y = 765, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies descritas")+
ggtitle("Angiospermas")+
theme_bw()
gimno <- read_excel("Data/Raw/Gimnospermas_07 08 2023.xlsx")
gimno <- read_excel("Data/Raw/Gimnospermas_07 08 2023.xlsx")
##looking in powo and ipni
gimno_rep = present_FB(gimno)
x <- gimno_rep %>% filter(publicationYear >= 2013) %>%
count('publicationYear') %>%
mutate(tot = cumsum(freq))
x
gimno_rep
View(gimno_rep)
write_csv(x, file = "Data/Metadata/Angiosperms/angio_riqueza.csv")
x <- angio_rep %>% filter(publicationYear >= 2013) %>%
count('publicationYear') %>%
mutate(tot = cumsum(freq))
write_csv(x, file = "Data/Metadata/Angiosperms/angio_riqueza.csv")
write_csv(x, file = "Data/Metadata/Angiosperms/gimno_riqueza.csv")
x <- gimno_rep %>% filter(publicationYear >= 2013) %>%
count('publicationYear') %>%
mutate(tot = cumsum(freq))
write_csv(x, file = "Data/Metadata/Angiosperms/gimno_riqueza.csv")
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 400, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 1950, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Gimnospermas")+
theme_bw()
##looking in powo and ipni
gimno_rep = present_FB(gimno)
x <- gimno_rep %>%
count('publicationYear') %>%
mutate(tot = cumsum(freq))
x
write_csv(x, file = "Data/Metadata/Angiosperms/gimno_riqueza.csv")
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 400, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 1950, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Gimnospermas")+
theme_bw()
max(x$publicationYear)
x <- gimno_rep %>%
count('publicationYear') %>%
mutate(tot = cumsum(freq)) %>%
drop_na()
write_csv(x, file = "Data/Metadata/Angiosperms/gimno_riqueza.csv")
x
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 400, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 1950, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Gimnospermas")+
theme_bw()
x <- gimno_rep %>%
count('publicationYear') %>%
mutate(tot = cumsum(freq)) %>%
drop_na() %>%
filter(publicationYear >= 1982)
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 15, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 15, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Gimnospermas")+
theme_bw()
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 18, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 19, y = 15, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Gimnospermas")+
theme_bw()
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 18, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 19, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Gimnospermas")+
theme_bw()
##with the cumulative sum
png("text/Figures/gimno_sp_acum.png", width = 22,
height = 12, units = "cm",
pointsize = 8, res = 300)
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 18, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 19, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Gimnospermas")+
theme_bw()
dev.off()
##with the cumulative sum
png("text/Figures/gimno_sp_acum.png", width = 25,
height = 10, units = "cm",
pointsize = 8, res = 300)
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 18, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 19, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Gimnospermas")+
theme_bw()
dev.off()
##with the cumulative sum
png("text/Figures/gimno_sp_acum.png", width = 30,
height = 10, units = "cm",
pointsize = 8, res = 300)
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 18, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 19, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Gimnospermas")+
theme_bw()
dev.off()
##with the cumulative sum
png("text/Figures/gimno_sp_acum.png", width = 35,
height = 10, units = "cm",
pointsize = 8, res = 300)
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 18, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 19, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Gimnospermas")+
theme_bw()
dev.off()
ggplot(x, aes(x = publicationYear, y = freq))+
geom_line()+
geom_point()+
geom_label(label = x$freq)+
#geom_label(label = "HV", x = 2013, y = 150, fill = "lightblue")+
#geom_label(label = "Flora Brasil", x = 2020, y = 765, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies descritas")+
ggtitle("Gimnospermas")+
theme_bw()
list.files("Data/Raw")
samam <- read_excel("Data/Raw/Samambaias e Licofitas_07 08 2023.xlsx")
View(samam)
##looking in powo and ipni
samam_rep = present_FB(samam)
samam_rep
x <- samam_rep %>% filter(publicationYear >= 2013) %>%
count('publicationYear') %>%
mutate(tot = cumsum(freq))
View(x)
write_csv(x, file = "Data/Metadata/Angiosperms/samam_riqueza.csv")
#themes
mynamestheme <- theme(strip.text = element_text(family = "serif", size = (11)),
axis.title = element_text(family = "serif", size = (12),
face = "bold"),
axis.text = element_text(family = "serif", size = (9)),
legend.title = element_text(family = "serif", size = (11),
face = "bold"),
legend.text = element_text(family = "serif", size = (10)),
legend.position = "bottom",
legend.background = element_rect(fill="gray90",
size=.5, linetype="dotted"))
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
#geom_label(label = "HV", x = 2013, y = 400, fill = "lightblue")+
#geom_label(label = "Flora Brasil", x = 2020, y = 1950, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Samambaias e Licófitas")+
theme_bw()
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 10, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 105, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Samambaias e Licófitas")+
theme_bw()
##with the cumulative sum
png("text/Figures/samam_sp_acum.png", width = 17,
height = 12, units = "cm",
pointsize = 8, res = 300)
ggplot(x, aes(x = publicationYear, y = tot))+
geom_line()+
geom_point()+
geom_label(label = x$tot)+
geom_label(label = "HV", x = 2013, y = 10, fill = "lightblue")+
geom_label(label = "Flora Brasil", x = 2020, y = 105, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies acumuladas")+
ggtitle("Samambaias e Licófitas")+
theme_bw()
dev.off()
##with the frequency
png("text/Figures/samam_sp_freq.png", width = 17,
height = 12, units = "cm",
pointsize = 8, res = 300)
ggplot(x, aes(x = publicationYear, y = freq))+
geom_line()+
geom_point()+
geom_label(label = x$freq)+
#geom_label(label = "HV", x = 2013, y = 150, fill = "lightblue")+
#geom_label(label = "Flora Brasil", x = 2020, y = 765, fill = "lightblue")+
scale_x_continuous(breaks = seq(min(x$publicationYear), max(x$publicationYear), by = 1))+
xlab("Ano")+
ylab("Espécies descritas")+
ggtitle("Samambaias e Licófitas")+
theme_bw()
dev.off()
